# DMA
- DMA的基本定义DMA，全称Direct Memory Access，即直接存储器访问。
- DMA传输将数据从一个地址空间复制到另一个地址空间，提供在外设和存储器之间或者存储器和存储器之间的高速数据传输。
- 当CPU初始化这个传输动作，传输动作本身是由DMA控制器来实现和完成的。DMA传输方式无需CPU直接控制传输，也没有中断处理方式那样保留现场和恢复现场过程，通过硬件为RAM和IO设备开辟一条直接传输数据的通道，使得CPU的效率大大提高。
- DMA的主要特征·每个通道都直接连接专用的硬件DMA请求，每个通道都同样支持软件触发，这些功能通过软件来配置。
    - ·在同一个DMA模块上，多个请求间的优先权可以通过软件编程设置（共有四级：很高、高、中等和低），优先权设置相等时由硬件决定（请求0优先于请求1，依此类推）。
    - ·独立数据源和目标数据区的传输宽度（字节、半字、全字），模拟打包和拆包的过程。源和目标地址必须按数据传输宽度对齐。
    - ·支持循环的缓冲器管理。·每个通道都有3个事件标志（DMA半传输、DMA传输完成和DMA传输出错），这3个事件标志逻辑或成为一个单独的中断请求。
    - ·存储器和存储器间的传输、外设和存储器、存储器和外设之间的传输。
    - ·闪存、SRAM、外设的SRAM、APB1、APB2和AHB外设均可作为访问的源和目标。
    - ·可编程的数据传输数目：最大为65535（0xFFFF）。

数据传输可以以两种方式触发：一种软件请求数据，另一种由硬件异步传输。

## 软件请求数据

     调用的步骤可以概括如下（以read为例）：

1. 在进程调用 read 时，驱动程序的方法分配一个 DMA 缓冲区，随后指示硬件传送它的数据。进程进入睡眠。
2. 硬件将数据写入 DMA 缓冲区并在完成时产生一个中断。
3. 中断处理程序获得输入数据，应答中断，最后唤醒进程，该进程现在可以读取数据了。

## 由硬件异步传输

      在 DMA 被异步使用时发生的。以数据采集设备为例：

1. 硬件发出中断来通知新的数据已经到达。
2. 中断处理程序分配一个DMA缓冲区。
3. 外围设备将数据写入缓冲区，然后在完成时发出另一个中断。
4. 处理程序利用DMA分发新的数据，唤醒任何相关进程。

网卡传输也是如此，网卡有一个循环缓冲区（通常叫做 DMA 环形缓冲区）建立在与处理器共享的内存中。每一个输入数据包被放置在环形缓冲区中下一个可用缓冲区，并且发出中断。然后驱动程序将网络数据包传给内核的其它部分处理，并在环形缓冲区中放置一个新的 DMA 缓冲区。

驱动程序在初始化时分配DMA缓冲区，并使用它们直到停止运行。