# docker-mysql
```
#!/bin/bash

pwd=`pwd`

touch my.cnf # 配置文件
mkdir -p data # 挂载数据到外部
mkdir -p mysql-files # 如果挂载data，必须也要挂载mysql-files


docker run -d \
        --privileged=true \
        --network host \
        -e MYSQL_ROOT_PASSWORD=kanggege \
        --mount type=bind,src=${pwd}/my.cnf,dst=/etc/mysql/my.cnf,readonly \
        --mount type=bind,src=${pwd}/data,dst=/var/lib/mysql \
        --mount type=bind,src=${pwd}/mysql-files,dst=/var/lib/mysql-files \
        --name mysqlserver \
        mysql  --default-authentication-plugin=mysql_native_password
```

考虑到迁移和更改配置，我们将配置文件和数据文件挂载到本地
- 默认配置文件地址：/etc/mysql/my.cnf
- 默认数据文件夹地址：/var/lib/mysql

mysql很多启动参数可以通过容器内环境变量配置，详情请查文档

mysql8使用最新的登陆验证插件 caching_sha2_password 类似navicat客户端很多都不支持，所以在启动入口修改为 mysql_native_password

# 配置文件
- 命令在 /usr/bin/mysql  
- 数据 /var/lib/mysql 
- 启停脚本 /etc/init.d/mysql
- 使用 mysql --help | grep my.cnf 可以查看配置文件加载顺序 /etc/my.cnf /etc/mysql/my.cnf ~/.my.cnf 

一般情况下没有特殊需求，可以修改 /etc/mysql/my.cnf，需要覆盖时再创建新文件在 /etc/my.cnf


# 概览
![](imgs/1.png)

总的来说mysql可以分为 server 层和存储层

- server：所有跨存储引擎的功能都在server层实现，例如存储过程、触发器、视图等
- 存储层插件化实现，我们常用的是 innerDB，实现增删改查、事务、索引等功能