docker的管理机制非常适合安装测试软件，所以决定使用docker学习nginx

    docker run -p 127.0.0.2:80:80 --name mynginx --rm -d nginx

注意nginx默认cmd是启动nginx，我们不要覆盖他，可以再次进入的时候启动bash
    
    docker exec -it mynginx bash

在 /usr/share/nginx/html/index.html 可以看到nginx的欢迎页

先把nginx的html文件和配置文件映射到本地，再修改配置，否则容器删除后自己的修改都没了

    docker run -d --name mynginx \
    --mount type=bind,source=$PWD/nginx/html,target=/usr/share/nginx/html \
    --mount type=bind,source=$PWD/nginx/conf,target=/etc/nginx \
    -p 127.0.0.2:80:80 \
    -p 127.0.0.2:443:443 \
    nginx 


ngxin主要作用是静态资源的分发、反向代理，提供的功能简单但又多样化，所以操作命令很简单，主要是配置文件复杂

    nginx -s stop       快速关闭Nginx，可能不保存相关信息，并迅速终止web服务。
    nginx -s quit       平稳关闭Nginx，保存相关信息，有安排的结束web服务。
    nginx -s reload     因改变了Nginx相关配置，需要重新加载配置而重载。
    nginx -s reopen     重新打开日志文件。
    nginx -c filename   为 Nginx 指定一个配置文件，来代替缺省的。
    nginx -t            不运行，而仅仅测试配置文件。nginx 将检查配置文件的语法的正确性，并尝试打开配置文件中所引用到的文件。
    nginx -v            显示 nginx 的版本。
    nginx -V            显示 nginx 的版本，编译器版本和配置参数。

# 配置文件

## 基本配置

    #运行用户
    #user somebody;

    #启动进程,通常设置成和cpu的数量相等
    worker_processes  1;

    #全局错误日志，错误级别
    error_log  D:/Tools/nginx-1.10.1/logs/error.log;
    error_log  D:/Tools/nginx-1.10.1/logs/notice.log  notice;
    error_log  D:/Tools/nginx-1.10.1/logs/info.log  info;

    #PID文件，记录当前启动的nginx的进程ID
    pid        D:/Tools/nginx-1.10.1/logs/nginx.pid;

    #工作模式及连接数上限
    events {
        worker_connections 1024;    #单个后台worker process进程的最大并发链接数
    }

## http配置

    #设定http服务器，利用它的反向代理功能提供负载均衡支持
    http {
        #设定mime类型(邮件支持类型),类型由mime.types文件定义
        include       D:/Tools/nginx-1.10.1/conf/mime.types;
        default_type  application/octet-stream;

        #设定日志
        log_format  main  '[$remote_addr] - [$remote_user] [$time_local] "$request" '
                        '$status $body_bytes_sent "$http_referer" '
                        '"$http_user_agent" "$http_x_forwarded_for"';

        access_log    D:/Tools/nginx-1.10.1/logs/access.log main;
        rewrite_log     on;

        #sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，
        #必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的uptime.
        sendfile        on;
        #tcp_nopush     on;

        #连接超时时间
        keepalive_timeout  120;
        tcp_nodelay        on;

        #gzip压缩开关
        #gzip  on;

        #设定实际的服务器列表
        upstream zp_server1{
            server 127.0.0.1:8089;
        }

        #HTTP服务器
        server {
            #监听80端口，80端口是知名端口号，用于HTTP协议
            listen       80;

            #定义使用www.xx.com访问
            server_name  www.helloworld.com;

            #首页
            index index.html

            #指向webapp的目录
            root D:\01_Workspace\Project\github\zp\SpringNotes\spring-security\spring-shiro\src\main\webapp;

            #编码格式
            charset utf-8;

            #代理配置参数
            proxy_connect_timeout 180;
            proxy_send_timeout 180;
            proxy_read_timeout 180;
            proxy_set_header Host $host;
            proxy_set_header X-Forwarder-For $remote_addr;

            #反向代理的路径（和upstream绑定），location 后面设置映射的路径
            location / {
                proxy_pass http://zp_server1;
            }

            #静态文件，nginx自己处理
            location ~ ^/(images|javascript|js|css|flash|media|static)/ {
                root D:\01_Workspace\Project\github\zp\SpringNotes\spring-security\spring-shiro\src\main\webapp\views;
                #过期30天，静态文件不怎么更新，过期可以设大一点，如果频繁更新，则可以设置得小一点。
                expires 30d;
            }

            #设定查看Nginx状态的地址
            location /NginxStatus {
                stub_status           on;
                access_log            on;
                auth_basic            "NginxStatus";
                auth_basic_user_file  conf/htpasswd;
            }

            #禁止访问 .htxxx 文件
            location ~ /\.ht {
                deny all;
            }

            #错误处理页面（可选择性配置）
            #error_page   404              /404.html;
            #error_page   500 502 503 504  /50x.html;
            #location = /50x.html {
            #    root   html;
            #}
        }
    }
